"use strict";function onDeviceReady(){7===parseFloat(window.device.version)&&(document.body.className=document.body.className+" phone-toolbar-spacing")}angular.module("timerApp",["ngRoute","ajoslin.mobile-navigate","ngTouch","ui.bootstrap","LP.services","LP.config"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/Timer",{templateUrl:"views/timepicker.modal.html",controller:"TimepickerModalCtrl",resolve:{title:function(){return"Timer"},timeId:function(){return"timer"}}}).when("/IntervalTimer",{templateUrl:"views/timepicker.modal.html",controller:"TimepickerModalCtrl",resolve:{title:function(){return"Interval"},timeId:function(){return"intervalTimer"}}}).when("/Settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).when("/Info",{templateUrl:"views/info.html",controller:"InfoCtrl"}).otherwise({redirectTo:"/"})}]).value("appProperties",{version:"0.0.1"}),angular.module("LP.config",[]),angular.module("LP.config").factory("deviceEvents",["$log",function(a){return{vibrate:function(b){void 0!==navigator.notification?navigator.notification.vibrate(b):a.info("vibrate not supported")},acquire:function(b,c){"undefined"!=typeof PowerManagement?PowerManagement.acquire(b,c):a.info("PowerManagement not supported")},release:function(b,c){"undefined"!=typeof PowerManagement?PowerManagement.release(b,c):a.info("PowerManagement not supported")}}}]),angular.module("LP.config").factory("events",["deviceEvents",function(a){return{intervalTick:function(){document.getElementById("clock-tick-sound").play()},intervalEnd:function(){a.vibrate(1e3),document.getElementById("bell-sound").play()},start:function(){a.acquire(function(){alert("success")},function(){alert("failure")})},cancel:function(){a.vibrate(1e3),document.getElementById("bell-cancel-sound").play(),a.vibrate(1e3),a.release(function(){alert("success")},function(){alert("failure")})},complete:function(){a.vibrate(1e3),document.getElementById("bell-complete-sound").play(),a.release(function(){alert("success")},function(){alert("failure")})}}}]),angular.module("timerApp").controller("MainCtrl",["$scope","$timeout","$navigate","events","dataStore","Timer",function(a,b,c,d,e,f){a.timer=e.get("timer"),a.intervalTimer=e.get("intervalTimer"),a.repeat=e.get("repeat"),a.useIntervalTimer=e.get("useIntervalTimer"),a.timeVisual=new Date(a.timer),a.$watch("timer",function(){a.timeVisual=new Date(a.timer)}),a.$watch("useIntervalTimer",function(a){e.save("useIntervalTimer",a)});var g,h;a.isRunning=!1,a.isTimerRunning=!1,a.hstep=1,a.mstep=1,a.sstep=1,a.showTimerModal=function(){c.go("/Timer","modal")},a.showIntervalModal=function(){c.go("/IntervalTimer","modal")},a.start=function(){a.isRunning||(d.start(),e.save("repeat",a.repeat)),e.save("timer",a.timer),e.save("intervalTimer",a.intervalTimer),a.isRunning=!0,a.isTimerRunning=!0,g=new f({timestamp:a.timer,interval:1e3}),g.start(function(b){d.intervalTick(),a.timer=b}).then(function(){d.intervalEnd(),a.timer=e.get("timer"),a.repeat>1?(a.repeat--,a.useIntervalTimer?(h=new f({timestamp:a.intervalTimer,interval:1e3}),h.start(function(b){a.isTimerRunning=!1,d.intervalTick(),a.intervalTimer=b}).then(function(){d.intervalEnd(),a.intervalTimer=e.get("intervalTimer"),a.start()})):a.start()):(a.isRunning=!1,a.stop())})},a.stop=function(){a.isTimerRunning=!1,a.isRunning?d.cancel():d.complete(),a.isRunning=!1,g.cancel(),h&&h.cancel(),a.timer=e.get("timer"),a.intervalTimer=e.get("intervalTimer"),a.repeat=e.get("repeat")},a.settings=function(){c.go("/Settings","slide",!0)},a.info=function(){c.go("/Info")}}]),angular.module("timerApp").controller("SettingsCtrl",["$scope","$navigate",function(a,b){a.back=function(){b.go("/")}}]),angular.module("timerApp").controller("InfoCtrl",["$scope","$navigate","appProperties",function(a,b,c){a.version=c.version,a.device=window.device,a.back=function(){b.go("/","slide",!0)}}]),angular.module("timerApp").controller("TimepickerModalCtrl",["$scope","$navigate","dataStore","timeId","title",function(a,b,c,d,e){a.title=e,a.time=new Date(c.get(d)),a.hours=a.time.getHours(),a.minutes=a.time.getMinutes(),a.seconds=a.time.getSeconds(),a.$watch("hours",function(b){a.time.setHours(b),c.save(d,a.time)}),a.$watch("minutes",function(b){a.time.setMinutes(b),c.save(d,a.time)}),a.$watch("seconds",function(b){a.time.setSeconds(b),c.save(d,a.time)}),a.back=function(){b.go("/","modal",!0)}}]),angular.module("timerApp").constant("timepickerConfig",{hourStep:1,minuteStep:1,secondStep:1,readonlyInput:!1}).directive("lpTimepicker",["$parse","$log","$timeout","timepickerConfig",function(a,b,c,d){return{restrict:"EA",require:"?^ngModel",replace:!0,scope:{},templateUrl:"views/directives/timepicker.html",link:function(e,f,g,h){function i(){var a=parseInt(e.hours,10);return a>=0&&24>a?a:void 0}function j(){var a=parseInt(e.minutes,10);return a>=0&&60>a?a:void 0}function k(){var a=parseInt(e.seconds,10);return a>=0&&60>a?a:void 0}function l(a){return angular.isDefined(a)&&a.toString().length<2?"0"+a:a}function m(a){n(),h.$setViewValue(new Date(q)),o(a)}function n(){h.$setValidity("time",!0),e.invalidHours=!1,e.invalidMinutes=!1}function o(a){var b=q.getHours(),c=q.getMinutes(),d=q.getSeconds();e.hours="h"===a?b:l(b),e.minutes="m"===a?c:l(c),e.seconds="s"===a?d:l(d)}function p(a){var b=new Date(q.getTime()+6e4*a);q.setHours(b.getHours(),b.getMinutes(),b.getSeconds()),m()}if(h){var q=new Date;if(h.$error.time){var r=i(),s=j(),t=k();angular.isDefined(r)&&angular.isDefined(s)&&angular.isDefined(t)&&(q.setHours(r),q.setMinutes(s),q.setSeconds(t),m())}else q=new Date(h.$viewValue),o();var u=d.hourStep;g.hourStep&&e.$parent.$watch(a(g.hourStep),function(a){u=parseInt(a,10)});var v=d.minuteStep;g.minuteStep&&e.$parent.$watch(a(g.minuteStep),function(a){v=parseInt(a,10)});var w=d.secondStep;g.minuteStep&&e.$parent.$watch(a(g.secondStep),function(a){w=parseInt(a,10)});var x=f.find("input"),y=x.eq(0),z=x.eq(1),A=x.eq(2);if(e.readonlyInput=angular.isDefined(g.readonlyInput)?e.$eval(g.readonlyInput):d.readonlyInput,e.readonlyInput)e.updateHours=angular.noop,e.updateMinutes=angular.noop,e.updateSeconds=angular.noop;else{var B=function(a,b,c){h.$setViewValue(null),h.$setValidity("time",!1),angular.isDefined(a)&&(e.invalidHours=a),angular.isDefined(b)&&(e.invalidMinutes=b),angular.isDefined(c)&&(e.invalidSeconds=c)};e.updateHours=function(){var a=i();angular.isDefined(a)?(q.setHours(a),m("h")):B(!0)},y.bind("blur",function(){!e.validHours&&e.hours<10&&e.$apply(function(){e.hours=l(e.hours)})}),e.updateMinutes=function(){var a=j();angular.isDefined(a)?(q.setMinutes(a),m("m")):B(void 0,!0)},z.bind("blur",function(){!e.invalidMinutes&&e.minutes<10&&e.$apply(function(){e.minutes=l(e.minutes)})}),e.updateSeconds=function(){var a=k();angular.isDefined(a)?(q.setSeconds(a),m("s")):B(void 0,void 0,!0)},A.bind("blur",function(){!e.invalidSeconds&&e.seconds<10&&e.$apply(function(){e.seconds=l(e.seconds)})})}h.$render=function(){var a=h.$modelValue?new Date(h.$modelValue):null;isNaN(a)?(h.$setValidity("time",!1),b.error('Timepicker directive: "ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.')):(a&&(q=a),n(),o())},e.incrementHours=function(){p(60*u)},e.decrementHours=function(){p(60*-u)},e.incrementMinutes=function(){p(v)},e.decrementMinutes=function(){p(-v)},e.incrementSeconds=function(){c(function(){p(w/60)},100)},e.decrementSeconds=function(){p(-w/60)}}}}}]),angular.module("timerApp").filter("range",function(){return function(a,b,c){var d=0;for(c===!1&&(d=1,b++),b=parseInt(b,10),d;b>d;d++)a.push(d);return a}}),angular.module("LP.services",["LocalStorageModule"]),angular.module("LP.services").factory("Timer",["$q","$timeout","$log",function(a,b,c){return function(d){if(!d.timestamp||!d.interval)throw new Error("Missing argument(s)");var e,f=a.defer(),g=this,h=d.timestamp,i=d.interval;this.running=!1,this.interval=function(a){if(g.running){h-=i,c.info(h),e=b(function(){g.interval(a)},i);var d=new Date(h);0===d.getHours()&&0===d.getMinutes()&&0===d.getSeconds()&&g.stop(),a(h)}},this.start=function(a){return g.running=!0,b(function(){g.interval(a)},i),f.promise},this.cancel=function(){return g.running=!1,f.reject()},this.stop=function(){b.cancel(e),f.resolve()}}}]),angular.module("LP.services").factory("dataStore",["localStorageService",function(a){var b=this,c={timer:(new Date).setHours(0,0,5,0),intervalTimer:(new Date).setHours(0,0,3,0),useIntervalTimer:!0,repeat:2};return this.timer=function(){return isNaN(new Date(parseInt(a.get("timer"),10)).getMonth())?c.timer:parseInt(a.get("timer"),10)},this.intervalTimer=function(){return isNaN(new Date(parseInt(a.get("intervalTimer"),10)).getMonth())?c.intervalTimer:parseInt(a.get("intervalTimer"),10)},this.useIntervalTimer=function(){return JSON.parse(a.get("useIntervalTimer"))},this.repeat=function(){return parseInt(a.get("repeat"),10)||c.repeat},{get:function(a){return b[a]()},save:function(b,c){null!==c&&c.getTime&&(c=c.getTime()),a.add(b,c)}}}]),document.addEventListener("deviceready",onDeviceReady,!1),angular.bootstrap(document.getElementsByTagName("body")[0],["timerApp"]);